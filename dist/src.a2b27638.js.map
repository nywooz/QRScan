{"version":3,"sources":["src/index.js"],"names":["state","date","Date","link","enableScan","color","video","canvasElement","canvas","loadingMessage","outputMessage","outputData","scanBtn","preloaderScan","registerDomElements","addEvListener","startScanner","addEventListener","endScan","innerText","className","disabled","document","createElement","getElementById","getContext","querySelector","drawLine","begin","end","beginPath","moveTo","x","y","lineTo","lineWidth","strokeStyle","stroke","navigator","mediaDevices","getUserMedia","facingMode","then","stream","srcObject","setAttribute","play","requestAnimationFrame","tick","readyState","HAVE_ENOUGH_DATA","hidden","height","videoHeight","width","videoWidth","drawImage","imageData","getImageData","code","jsQR","data","inversionAttempts","location","topLeftCorner","topRightCorner","bottomRightCorner","bottomLeftCorner","parentElement","includes","href","appendChild"],"mappings":"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","file":"src.a2b27638.js","sourceRoot":"..","sourcesContent":["const state = {\r\n  date: new Date(),\r\n  link: \"\",\r\n  enableScan: true,\r\n  color: \"#FF3B58\"\r\n};\r\n\r\nlet video;\r\nlet canvasElement;\r\nlet canvas;\r\nlet loadingMessage;\r\nlet outputMessage;\r\nlet outputData;\r\nlet scanBtn;\r\nlet preloaderScan;\r\n\r\nregisterDomElements();\r\naddEvListener();\r\nstartScanner();\r\n\r\nfunction addEvListener() {\r\n  scanBtn.addEventListener(\"click\", startScanner);\r\n}\r\n\r\nfunction endScan() {\r\n  scanBtn.innerText = \"Scan again\";\r\n  scanBtn.className = \"btn btn-primary mb-1\";\r\n  scanBtn.disabled = state.enableScan = false;\r\n  preloaderScan.className = \"preloader-scanned\";\r\n}\r\n\r\nfunction registerDomElements() {\r\n  video = document.createElement(\"video\");\r\n  canvasElement = document.getElementById(\"canvas\");\r\n  canvas = canvasElement.getContext(\"2d\");\r\n  loadingMessage = document.getElementById(\"loadingMessage\");\r\n  outputMessage = document.getElementById(\"outputMessage\");\r\n  outputData = document.getElementById(\"outputData\");\r\n  preloaderScan = document.querySelector(\".preloader-scan\");\r\n  scanBtn = document.getElementById(\"scan\");\r\n}\r\n\r\nfunction drawLine(begin, end, color) {\r\n  canvas.beginPath();\r\n  canvas.moveTo(begin.x, begin.y);\r\n  canvas.lineTo(end.x, end.y);\r\n  canvas.lineWidth = 4;\r\n  canvas.strokeStyle = color;\r\n  canvas.stroke();\r\n}\r\n\r\nfunction startScanner() {\r\n  scanBtn.innerText = \"Scanning...\";\r\n  scanBtn.className = \"btn btn-info mb-1\";\r\n  state.enableScan = true;\r\n\r\n  // Use facingMode: environment to attemt to get the front camera on phones\r\n  navigator.mediaDevices\r\n    .getUserMedia({ video: { facingMode: \"environment\" } })\r\n    .then(function(stream) {\r\n      video.srcObject = stream;\r\n      video.setAttribute(\"playsinline\", true); // required to tell iOS safari we don't want fullscreen\r\n      video.play();\r\n      requestAnimationFrame(tick);\r\n    });\r\n  preloaderScan.className = \"preloader-scan\";\r\n}\r\n\r\nfunction tick() {\r\n  if (!state.enableScan) return;\r\n  loadingMessage.innerText = \"âŒ› Loading video...\";\r\n  if (video.readyState === video.HAVE_ENOUGH_DATA) {\r\n    loadingMessage.hidden = true;\r\n    canvasElement.hidden = false;\r\n\r\n    canvasElement.height = video.videoHeight;\r\n    canvasElement.width = video.videoWidth;\r\n    canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);\r\n    const imageData = canvas.getImageData(\r\n      0,\r\n      0,\r\n      canvasElement.width,\r\n      canvasElement.height\r\n    );\r\n    const code = jsQR(imageData.data, imageData.width, imageData.height, {\r\n      inversionAttempts: \"dontInvert\"\r\n    });\r\n    if (code) {\r\n      drawLine(\r\n        code.location.topLeftCorner,\r\n        code.location.topRightCorner,\r\n        state.color\r\n      );\r\n      drawLine(\r\n        code.location.topRightCorner,\r\n        code.location.bottomRightCorner,\r\n        state.color\r\n      );\r\n      drawLine(\r\n        code.location.bottomRightCorner,\r\n        code.location.bottomLeftCorner,\r\n        state.color\r\n      );\r\n      drawLine(\r\n        code.location.bottomLeftCorner,\r\n        code.location.topLeftCorner,\r\n        state.color\r\n      );\r\n      if (outputMessage) outputMessage.hidden = true;\r\n      outputData.parentElement.parentElement.hidden = false;\r\n      outputData.innerText = code.data;\r\n\r\n      if (code.data && code.data.includes(\"https:\")) {\r\n        outputData.innerText = \"\";\r\n\r\n        var link = document.createElement(\"a\");\r\n        state.link = link.innerText = link.href = code.data;\r\n        link.className = \"badge badge-primary p-2\";\r\n        outputData.appendChild(link);\r\n        // outputData.innerText = code.data;\r\n        endScan();\r\n      }\r\n    } else {\r\n      state.link = \"\";\r\n      state.enableScan = true;\r\n      scanBtn.disabled = true;\r\n      //scanBtn.setAttribute(\"disabled\", \"\");\r\n      if (outputMessage) outputMessage.hidden = false;\r\n      outputData.parentElement.parentElement.hidden = true;\r\n    }\r\n  }\r\n  requestAnimationFrame(tick);\r\n}\r\n"]}